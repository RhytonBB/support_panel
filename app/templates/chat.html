<!-- chat.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Чат поддержки</title>
    <style>
        .message { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .user { background-color: #e0f7fa; }
        .admin { background-color: #ffe0b2; }
        .meta { font-size: 0.8em; color: gray; }
    </style>
</head>
<body>
    <h2>Обращение в поддержку</h2>
    <p><strong>Пользователь:</strong> {{ full_name }}</p>

    <div class="chat">
        {% for msg in messages %}
            <div class="message {{ 'user' if msg.sender_role == 'user' else 'admin' }}">
                <div>{{ msg.text }}</div>
                <div class="meta">{{ msg.created_at.strftime("%d.%m.%Y %H:%M") }}</div>
                {% if msg.media %}
                    <div>
                        {% for media_url in msg.media %}
                            {% if media_url.endswith(('.mp4', '.webm')) %}
                                <video width="200" controls><source src="{{ media_url }}" type="video/mp4"></video>
                            {% else %}
                                <img src="{{ media_url }}" alt="media" style="max-width: 200px;">
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    {% if status == 'closed' %}
        <p><em>Обращение закрыто. Вы не можете отправлять сообщения.</em></p>
    {% else %}
        <form method="POST" action="{{ url_for('views.send_operator_message', request_id=request_id) }}" enctype="multipart/form-data">
            <textarea name="text" rows="3" placeholder="Введите сообщение..." style="width:100%"></textarea><br>
            <input type="file" name="media" multiple accept="image/*,video/*"><br>
            <button type="submit">Отправить</button>
        </form>
        <form method="POST" action="{{ url_for('views.close_request', request_id=request_id) }}" style="margin-top:10px;">
            <button type="submit" style="background-color:red;color:white;">Закрыть обращение</button>
        </form>
    {% endif %}
</body>
</html>
